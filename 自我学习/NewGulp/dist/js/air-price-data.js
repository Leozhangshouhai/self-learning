function change_Ip(e){air_price.get_planeInfo.url=e+"hmp_website/yiplain/getplainlist.json"}$(function(){air_price.type=ZSH_Extent.getPostUrl("type"),air_price.sign=ZSH_Extent.getPostUrl("sign"),fun.judge_go_And_back()});var fun={judge_go_And_back:function(){var e=1==air_price.type&&2==air_price.sign;if(air_price.air_json=Storage.get("json_plane"),e){air_price.all_plane=Storage.get("json_plane_back"),air_price.plane_go_index=Storage.get("json_plane_go_index"),$(".header-chufa").html(air_price.air_json.ecity),$(".header-daoda").html(air_price.air_json.scity+"(返程)");var i=air_price.air_json.date_back.split("-")}else{layer.open({type:2,shadeClose:!1}),$(".header-chufa").html(air_price.air_json.scity),$(".header-daoda").html(air_price.air_json.ecity+"(去程)");var i=air_price.air_json.date.split("-")}if(json.year=Number(i[0]),json.month=Number(i[1]),json.day=Number(i[2]),json.weekday=air_price.air_json.weekday,export_fun.init(),console.log(calendar.arr),air_price.head_date_click(),e){var a=air_price.bubbling_order(air_price.all_plane.firstFlightList,"time");$($("#fixed .fixed-choose-detail")[1]).html(a[a.length-1].takeOffTime),a=air_price.bubbling_order(air_price.all_plane.secondFlightList,"price"),air_price.date_bind(a),$($("#fixed .fixed-choose-detail")[0]).html(a[a.length-1].cabinSeatList[0].cabinSeatPrice),$("#container").show(200),$("#fixed").show(200),page.change_click()}else 2==air_price.air_json.type?(air_price.get_planeInfo.parameters.type="2",air_price.get_planeInfo.parameters.scity=air_price.air_json.scity_3,air_price.get_planeInfo.parameters.ecity=air_price.air_json.ecity_3,air_price.get_planeInfo.parameters.date=air_price.air_json.date,air_price.get_planeInfo.parameters.date_back=air_price.air_json.date_back):1==air_price.air_json.type&&(air_price.get_planeInfo.parameters.type="1",air_price.get_planeInfo.parameters.scity=air_price.air_json.scity_3,air_price.get_planeInfo.parameters.ecity=air_price.air_json.ecity_3,air_price.get_planeInfo.parameters.date=air_price.air_json.date),Ajax_json(air_price.get_planeInfo,change_Ip)}},export_fun={init:function(){calendar.init(json),page.time_show()}},air_price={air_json:"",type:"",head_click:!1,all_plane:{},order_by_price:function(e,i){return parseFloat(e)>=parseFloat(i)},order_by_time:function(e,i){return 60*e.substring(0,2)*60+60*e.substring(3,5)>=60*i.substring(0,2)*60+60*i.substring(3,5)},order_by_speed:function(e,i){var a=e.split("小时"),r=i.split("小时");return 60*parseInt(a[0])+parseInt(a[1])>=60*parseInt(r[0])+parseInt(r[1])},bubbling_order:function(e,i){var a,r,t,s=e;if("price"==i)for(a=0;a<s.length&&a!=s.length-1;a++)for(r=a+1;r<s.length;r++)air_price.order_by_price(s[a].cabinSeatList[0].cabinSeatPrice,s[r].cabinSeatList[0].cabinSeatPrice)||(t=s[a],s[a]=s[r],s[r]=t);else if("time"==i)for(a=0;a<s.length&&a!=s.length-1;a++)for(r=a+1;r<s.length;r++)air_price.order_by_time(s[a].takeOffTime,s[r].takeOffTime)||(t=s[a],s[a]=s[r],s[r]=t);else if("speed"==i)for(a=0;a<s.length&&a!=s.length-1;a++)for(r=a+1;r<s.length;r++)air_price.order_by_speed(s[a].timediff,s[r].timediff)||(t=s[a],s[a]=s[r],s[r]=t);return s},date_bind:function(e){for(var i=0;i<e.length;i++){if(e[i].cabinSeatList.length>0){for(var a=e[i].airLogo,r=$("<dd class='airtickets-show-dd'><div class='airtickets-show-dd-box'><p class='airtickets-show-dd-name'>"+e[i].airName+"&nbsp;&nbsp;"+e[i].airCode+e[i].flightNo+"</p><div class='airtickets-show-dd-logo'><img src="+a+" alt='航空logo'/></div><div class='airtickets-show-dd-star'><span class='airtickets-show-dd-star-time'>"+e[i].takeOffTime+"</span><p class='airtickets-show-dd-start-add'>"+e[i].originCityName+e[i].terminal.substring(0,2)+"</p></div><div class='airtickets-show-dd-timelong'><p class='airtickets-show-dd-time-long'>"+e[i].timediff+"</p></div><div class='airtickets-show-dd-end'><span class='airtickets-show-dd-star-time'>"+e[i].arriveOffTime+"</span><p class='airtickets-show-dd-start-add'>"+e[i].arriveCityName+e[i].terminal.substring(3,5)+"</p></div><div class='airtickets-show-dd-price'><span class='airtickets-show-dd-price-money'>"+e[i].cabinSeatList[0].cabinSeatPrice+"</span><p class='airtickets-show-dd-price-sort'>"+e[i].cabinSeatList[0].cabinSeatGrade+"</p></div></div></dd>"),t=$('<dl class="airtickets-show-dd-detail"></dl>'),s=0;s<e[i].cabinSeatList.length;s++){var n=' <dd class="airtickets-show-dd-detail-dd" j='+s+" i="+i+'><p class="airtickets-show-dd-detail-dd-sort">'+e[i].cabinSeatList[s].cabinSeatGrade+'</p><p class="airtickets-show-dd-detail-dd-money">'+e[i].cabinSeatList[s].cabinSeatPrice+'</p><p class="airtickets-show-dd-detail-dd-rest">'+e[i].cabinSeatList[s].taxPrice+"(机建费)</p></dd>";t.append(n)}r.append(t)}$("#airtickets-show-dl").prepend(r)}page.binding_click()},delete_arr_null:function(e,i){for(var a=e.body.flightlist.responseData.flightData.firstFlightList,r=0;r<a.length;r++)0===a[r].cabinSeatList.length&&(a.splice(r,1),r--);if("2"==i)for(var t=e.body.flightlist.responseData.flightData.secondFlightList,s=0;s<t.length;s++)0===t[s].cabinSeatList.length&&(t.splice(s,1),s--)},head_date_click:function(){$(".time-show-dd").on("click",function(){air_price.head_click=!0,$(".time-show-dd").removeClass("time-show-dd-center"),$(this).addClass("time-show-dd-center"),layer.open({type:2,shadeClose:!1});var e=calendar.arr[$(this).attr("data-num")],i=e.year+"-"+e.month+"-"+e.day;air_price.get_planeInfo.parameters.type=air_price.sign,"2"==air_price.sign?"2"==air_price.type?(air_price.get_planeInfo.parameters.date=i,air_price.air_json.date=i):"1"==air_price.type&&(air_price.get_planeInfo.parameters.date_back=i,air_price.get_planeInfo.parameters.scity=air_price.air_json.scity_3,air_price.get_planeInfo.parameters.ecity=air_price.air_json.ecity_3,air_price.get_planeInfo.parameters.date=air_price.air_json.date,air_price.air_json.date_back=i):(air_price.get_planeInfo.parameters.date=i,air_price.air_json.date=i),Ajax_json(air_price.get_planeInfo,change_Ip)})},get_planeInfo:{url:"http://118.178.225.32/hmp_website/yiplain/getplainlist.json",parameters:{},success:function(e){if(console.log("航班信息"),layer.closeAll(),console.log(e.body.flightlist.responseData),"000000"===e.head.rtnCode&&null!=e.body.flightlist.responseData&&e.body.flightlist.responseData.flightData.firstFlightList&&e.body.flightlist.responseData.flightData.firstFlightList.length>0){air_price.delete_arr_null(e),air_price.all_plane.firstFlightList=e.body.flightlist.responseData.flightData.firstFlightList,"2"==e.body.type&&(air_price.delete_arr_null(e,"2"),air_price.all_plane.secondFlightList=e.body.flightlist.responseData.flightData.secondFlightList);var i=air_price.all_plane.firstFlightList;"2"==air_price.sign&&"1"==air_price.type&&(i=air_price.all_plane.secondFlightList);var a=air_price.bubbling_order(i,"time");$($("#fixed .fixed-choose-detail")[1]).html(a[a.length-1].takeOffTime),a=air_price.bubbling_order(i,"price"),air_price.date_bind(a),$($("#fixed .fixed-choose-detail")[0]).html(a[a.length-1].cabinSeatList[0].cabinSeatPrice),page.change_click(),layer.closeAll(),$("#container").show(200),$("#fixed").show(200),Storage.set("json_plane",air_price.air_json)}else $("#popup")&&$("#popup").hide(),layer.closeAll(),air_price.head_click?layer.open({content:"未查寻到相应航班",skin:"msg",time:2}):ZSH_Extent.createLoading("未查寻到相应航班","error")},error:function(e){layer.closeAll(),air_price.head_click?layer.open({content:"未查寻到相应航班",skin:"msg",time:2}):ZSH_Extent.createLoading("未查寻到相应航班","error")}}};