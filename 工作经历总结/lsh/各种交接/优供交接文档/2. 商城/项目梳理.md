# 项目梳理

## 1、优供首页

【项目主页】：http://yg.lsh123.com/

【测试页面】：http://yg-home.wmdev2.lsh123.com/

【项目介绍】：SEO页面，主要通过丰富的动画效果展示公司的服务。搜索链商优供的第一条结果。

【项目发布】：sh deploy.sh app qa

【相关人员】：@丹妮

【Git地址】：[https://github.com/lianshang/market-h5-fe/tree/master/app](https://github.com/lianshang/market-h5-fe/tree/master/app)

【目前状态】：稳定，后续可能有较小的修改需求。

## 2、跨端调研

【项目介绍】：解决后续业务跨端能力，调研第三方跨端平台

【相关人员】：@旭哥

【目前状态】：已经调研完毕，调研内容已经发给了旭哥，下一步是进行DEMO测试。

## 3、套壳方案

【项目介绍】：通过`jsbridge`的方式获取端的部分能力，这个能力在不同类型的app上表现不同，在销售端上表现为拍照、录音、定位，在优供商城上表现为：跳转、购物车操作等。

【涉及APP】：销售端、优供商城

【相关人员】：@丹妮、@鸣旭、@旭哥

【目前状态】：丹妮、鸣旭、旭哥都有接口定义经验，文档已经发给旭哥

【操作流程】：当需要加入新的接口或功能时，基本操作流程为：

* 确定接口的功能，咨询iOS/Android能否实现
* 因为涉及端的更改就会涉及到发版问题，所以确定这个需求在下版添加上，**有可能导致不同版本功能不同，注意兼容**
* 根据以往的接口定义规则，和iOS/Android确定接口以及返回的数据格式
* 自己在不同机型上进行测试
* 测试通过后方可上线

在运营活动项目中，对一些行为进行了相应的封装，代码地址为：

* **jsBridge** - https://github.com/lianshang/market-h5-fe/tree/master/cms/src/operation/lib/js/jsBridge
* **jumpTo** - https://github.com/lianshang/market-h5-fe/tree/master/cms/src/operation/lib/js/jumpTo

其中jumpTo是所有页面跳转行为的封装，可以一句代码同时在三个平台上进行相同行为的跳转。

## 4、运营活动H5

【项目介绍】：所有的运营活动H5页面，包括摇一摇、大转盘、签收满返等活动，活动一般具有一定程度的优惠或现金券，从而拉升各项指标（单单价、登录数、沉睡用户、订单量等）。但运营活动严重受运营成本的制约，运营会根据运营成本选择开展什么活动，或者不开展活动。

【相关人员】：@黄老师

【目前状态】：稳定，目前所有的运营活动都开展过，后续可能会有新活动需求或小幅度优化

【流程介绍】：

运营活动代码执行流程整体和CMS代码执行流程差不多，都是根据模板名称去查找相应的模板然后在执行相应的业务逻辑。下面说一下`index.js`的主要流程。

* 获取活动ID并验证 && 日志上报
* 获取Token并验证
* 通过ID、Token来获取活动配置信息：/static
* 信息返回后，时间验证 && 地区验证 && 模板查找并执行
* 信息返回后，开启活动倒计时 && 分享准备 && 设置标题

注意：只有在APP内才会获取Token，web下不获取Token，后端会从cookie中进行获取。

## 5、CMS

### 后端

【项目介绍】：CMS平台后端，基于Python与Flask，用来生成各个业务需要的静态资源数据，同时具有频道栏目管理、权限、活动的保存、预览与发布等功能。

【相关人员】：@锐哥

【目前状态】：稳定，正在进行老CMS的迁移

【流程介绍】：

该项目代码流程较为简单，重点部分未老CMS的预览发布流程，具体流程的解释写在了代码注释中，下面大致说一下单服务器预览/发布流程：

* 从服务器中获取用户名、IP
* ssh登录
* 创建目标文件夹 && 创建备份文件夹
* 将原来文件移动到备份文件夹
* 将本地文件移动到目标文件夹
* 将移动后的文件改名为data.json文件
* 记录成功发布的服务器
* 每一个过程都可能失败，任何失败都会中断操作

### 前端

【项目介绍】：CMS平台前端，基于Vue、Vuex、Vue-resource、Vue-router、element-ui

【相关人员】：@鸣旭、@黄老师

【目前状态】：稳定、运营活动搭建完毕、正在进行老CMS迁移

【流程介绍】：

该项目的基础搭建部分已经在上次分享上说完了，下面主要说下这次CMS优化中进行图片优化的事情：

* 图片上传组件被封装在`component/ui/upload/upload.vue`中，是对element的upload的封装，在业务中，所有的上传组件都已经替换完成
* 新的上传组件上传成功后，要保存`img_id`，而不是`origin`
* 图片跟地址以及其他配置信息单独存放到`api/config.js`中，包括图片地址、上传地址，以后所有的公共的地址尽量在这里保存，通过`this.CONFIG`进行调用
* 在其他业务中有显示图片的地方需要调用`mixin`中的`$mixinFormatImagePath()`方法，该方法在`lib/js/vue-mixin.js`中，其他公共方法也尽量放到该文件中来，同时需要引入mixins：`mixins: [mixin]`，同时为了在业务中能够清楚的知道该方法来自mixin，所以最好添加`$mixin`前缀


## 6、在线文档

【项目介绍】：收录前端人员的总结、经验的地方

【项目地址】：[http://lianshang.github.io/fe-doc/](http://lianshang.github.io/fe-doc/)

【Git地址】：[https://github.com/lianshang/fe-doc](https://github.com/lianshang/fe-doc)

【相关人员】：@黄老师

